<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Builder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        #left-menu, #right-menu {
            width: 200px;
            padding: 10px;
            background-color: #f8f9fa;
            border-right: 1px solid #dee2e6;
        }
        #left-menu {
            border-right: none;
            border-left: 1px solid #dee2e6;
        }
        #page-iframe {
            flex-grow: 1;
            border: none;
        }
        .draggable {
            cursor: move;
        }
    </style>
</head>
<body>

<div id="left-menu">
    <h5>Widgets</h5>
    <div class="draggable btn btn-secondary my-2" data-type="text">Text</div>
    <div class="draggable btn btn-secondary my-2" data-type="form">Form</div>
    <div class="draggable btn btn-secondary my-2" data-type="container">Container</div>
</div>

<iframe id="page-iframe" src="about:blank"></iframe>

<div id="right-menu">
    <h5>Properties</h5>
    <div id="properties-content">
        <p>Select a widget to see its properties</p>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>

<script>
$(function() {
    // Initialize draggable widgets
    $(".draggable").draggable({
        helper: "clone"
    });

    // Initialize iframe document
    let iframe = $("#page-iframe")[0];
    let iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
    iframeDoc.open();
    iframeDoc.write("<!DOCTYPE html><html><head><link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css' rel='stylesheet'></head><body><div id='page-content' class='container'></div></body></html>");
    iframeDoc.close();

    // Make iframe content droppable
    $(iframe).on("load", function() {
        let iframeBody = $(iframeDoc).find("body");

        $(iframeBody).find("#page-content").droppable({
            accept: ".draggable",
            drop: function(event, ui) {
                let type = $(ui.helper).data("type");
                let newElement;
                switch(type) {
                    case "text":
                        newElement = $("<p class='editable' contenteditable='true'>New Text</p>");
                        break;
                    case "form":
                        newElement = $("<form class='editable'><input type='text' placeholder='Text Input' class='form-control my-2'></form>");
                        break;
                    case "container":
                        newElement = $("<div class='editable container my-2' style='border: 1px solid #dee2e6; padding: 10px;'>New Container</div>");
                        break;
                }
                if (newElement) {
                    $(this).append(newElement);
                }
            }
        });

        // Handle widget selection
        $(iframeBody).on("click", ".editable", function(event) {
            event.stopPropagation();
            let element = $(this);
            $("#properties-content").empty();
            if (element.is("p")) {
                $("#properties-content").append('<div class="mb-3"><label for="textContent" class="form-label">Text Content</label><input type="text" id="textContent" class="form-control" value="' + element.text() + '"></div>');
                $("#textContent").on("input", function() {
                    element.text($(this).val());
                });
            } else if (element.is("form")) {
                $("#properties-content").append('<div class="mb-3"><label for="formContent" class="form-label">Form HTML</label><textarea id="formContent" class="form-control" rows="3">' + element.html() + '</textarea></div>');
                $("#formContent").on("input", function() {
                    element.html($(this).val());
                });
            } else if (element.is("div")) {
                $("#properties-content").append('<div class="mb-3"><label for="containerHTML" class="form-label">Container HTML</label><textarea id="containerHTML" class="form-control" rows="3">' + element.html() + '</textarea></div>');
                $("#containerHTML").on("input", function() {
                    element.html($(this).val());
                });
            }
        });

        // Deselect widget on iframe click
        $(iframeBody).on("click", function() {
            $("#properties-content").html("<p>Select a widget to see its properties</p>");
        });
    });
});
</script>

</body>
</html>
