{% include 'base.html' %}
{% block head %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/editor.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
    <style>
        body {
            display: flex;
            height: 100vh;
            margin: 0;
            background: #000c30;
        }
    </style>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dropzone.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/widgetMenu.css') }}">
{% endblock %}

{% block content %}
    <div class="sidebar">
        <h3>UI Library</h3>
        <div class="card" draggable="true" ondragstart="dragStart(event)">
            <div class="card-body">
                Navigation
            </div>
        </div>
        <div class="card" draggable="true" ondragstart="dragStart(event)">
            <div class="card-body">
                Headers
            </div>
        </div>
        <div class="card" draggable="true" ondragstart="dragStart(event)">
            <div class="card-body">
                Features
            </div>
        </div>
    </div>

    <div class="dropzone" ondrop="drop(event)" ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
        <div class="iframe-container">
            <div class="iframe-header">
                <div class="dots">
                    <span class="dot-1"></span>
                    <span class="dot-2"></span>
                    <span class="dot-3"></span>
                </div>
                <div class="title">file.html</div>
                <div class="icons">
                    <i class="bi bi-laptop" onclick="resizeIframe(1366)"></i>
                    <i class="bi bi-tablet" onclick="resizeIframe(778)"></i>
                    <i class="bi bi-phone" onclick="resizeIframe(390)"></i>
                </div>
            </div>
            <iframe class="iframe-content" src="{{ url_for('static', filename='cache/project-1/index.html') }}" frameborder="0"></iframe>
        </div>
    </div>

    <script>
        function resizeIframe(width) {
            document.querySelector('.iframe-container').style.width = width + 'px';
        }

        function dragStart(event) {
            event.dataTransfer.setData("text/plain", event.target.innerHTML);
            event.dataTransfer.effectAllowed = "copy";
        }

        function allowDrop(event) {
    event.preventDefault();
    if (event.target.closest('.dropzone')) {
        event.target.classList.add("dragover");
    }
}

function dragEnter(event) {
    event.preventDefault();
    if (event.target.closest('.dropzone')) {
        event.target.classList.add("dragover");
    }
}

function dragLeave(event) {
    if (event.target.closest('.dropzone')) {
        event.target.classList.remove("dragover");
    }
}

function drop(event) {
    event.preventDefault();
    event.target.classList.remove("dragover");

    const dropzone = event.target.closest('.dropzone');
    if (dropzone) {
        const data = event.dataTransfer.getData("text");
        const newElement = document.createElement("div");
        newElement.classList.add("card");
        newElement.innerHTML = `<div class="card-body">${data}</div>`;
        
        // Проверяем, если `iframe` находится в зоне сброса
        const iframe = dropzone.querySelector('iframe');
        if (iframe) {
            console.log("fef")
            const iframeDocument = iframe.contentDocument || iframe.contentWindow.document;
            iframeDocument.body.appendChild(newElement);
        }
    }
}

    </script>
{% endblock %}
